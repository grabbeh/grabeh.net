<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Grabeh.net</title>
  <link rel="stylesheet" href="https://unpkg.com/tachyons@4.7.0/css/tachyons.min.css" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/dracula.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>
  <style>
    body {
      font-family: 'Roboto', serif;
    }

    .grey {
      color: rgba(0, 0, 0, .4)
    }
  </style>
</head>

<body class="bg-light-red" id="container">
  <div class="pa2 f5 bg-white mb4 tc w3 shadow-5">
    <a class="b link black underline-hover" href='/'><i class="fa fa-home fa-2x" aria-hidden="true"></i></a>
  </div>
  <div class="pl5-l pr5-l mh4-ns mh2">
    <div class="fl w-70-l w-100">
      <div class="cf shadow-5 mb3 pa3 bg-white">
        <div class="f2 b">Image uploads and resizing with Transloadit</div>
      </div>
      <div class="mb4-l shadow-5 bg-white ph5-ns ph3 pv1">
        <div class="f4-ns f5 w-100  lh-copy">
          <p>Giving people the ability to upload photos has been on my mind for a while because photos are a great way to help
            evoke memories and also to give others a better idea of what a route involves (although I guess there’s always
            Google Street View for that).</p>
          <p>I had pondered different methods to upload images and in the end I’m now using a third party service in the form
            of <a href="http://www.transloadit.com">Transloadit</a>. Before starting with image uploads I was a little hesitant
            that it would be a task too complex for my beginner level experience so although I have previously preferred
            at certain times to build functionality myself, I was definitely interested in seeing how a third party service
            could make things easier for me.</p>
          <p>Transloadit has its own servers which you can use for image processing (in Routebop’s case resizing the image to
            a thumbnail before uploading both to an S3 instance. In terms of the front-end code, and on a basic level, Transloadit
            requires you to incorporate hidden fields in your file upload forms which allow you to send data to Transloadit’s
            servers detailing how you want images/media to be processed. This process blocks the normal submission of the
            form and once processed, links to the processed images are returned in a hidden form field and the whole form
            is then submitted to your server as usual.</p>
          <p>However, because Routebop just deals with submitting data via jQuery’s .ajax functionality, I used the Transloadit’s
            handily provided jQuery plugin to disable automatic submission of the form following Transloadit’s completion
            of its magic. Instead, on completion, the urls for the images as stored on S3 are firstly used to render a thumbnail
            on the routebop.com/new page and also stored in an object and pushed into an images array, ready to be submitted
            with the rest of the route when the user is ready.</p>
          <pre><code class="f5">
$('#MyForm').transloadit({ 
  wait: true, 
  autoSubmit: false, 
  modal: false, 
  onProgress: function(bytesReceived, bytesExpected){ 
    $('#progress').text("Progress: " + (bytesReceived / bytesExpected * 100)
    .toFixed(2)+'%'); 
  }, 
  onSuccess: function(assembly){ 
    $('#progress').text(""); 
    var thumburl = assembly.results.thumb[0].url; 
    var mainurl = assembly.results[':original'][0].url; 
    $('#thumb').append("<a href=" + mainurl + ">" + "<img src=" + thumburl + 
    "><span>x</span></a>"); 
    $('#thumb').find('span').addClass('removeImage'); 
    var imgUrls = {}; 
    imgUrls['thumburl'] = thumburl; 
    imgUrls['mainurl'] = mainurl; 
    images.push(imgUrls); 
    } 
}); 
</code></pre>
          <p>In addition to adding the thumbnail from Transloadit into the page, I also wanted to add a &#39;x&#39; button so
            users could remove the offending image. Mainly because I was lazy, instead of using an image of a red cross (to
            be clicked when a user wants to remove an uploaded image), I created a separate span and used a negative margin
            to push the <span>x</span> over the image in question. It doesn’t look quite as good as an image but I think
            it doesn’t look so bad (a fully circular span would be nice!). The code for that CSS is below.</p>
          <pre><code class="f5">
.removeImage {
  font-weight: bold;
  background: red;
  color: white;
  font-family: arial;
  font-size: 16px;
  margin-top: 0px;
  margin-right: 12px;
  margin-left: -8px;
  margin-bottom: 7px;
  border-radius: 15px;
  padding: 3px;
}
</code></pre>
          <p>Overall, I found incorporating Transloadit very straightforward and although I suspect I’m using it in a slightly
            different manner than intended, it’s working out well for me. Although it would definitely be interesting to
            explore building functionality to upload files directly to my S3 instance.</p>
        </div>
      </div>
    </div>
    <div class="mb3 mt0-l mt3 pl4-l fl w-30-l w-100">
      <div class="bg-white f4 pa3 shadow-5">
        <ul class="pa0 ma0 list">
          <li class="pv1"><a class="underline link black" href="https://twitter.com/grabbeh"><i class="mr2 fa fa-twitter "aria-hidden="true"></i>Twitter</a></li>
          <li class="pv1"><a class="underline  link black " href="https://github.com/grabbeh"><i class="mr2 fa fa-github" aria-hidden="true"></i>GitHub</a></li>
          <li class="pv1"><a class="underline  link black " href="/about"><i class="mr2 fa fa-user" aria-hidden="true"></i>About</a></li>
        </ul>
      </div>
    </div>
  </div>
</body>
<script>
  var arr = [
    "bg-red",
    "bg-purple",
    "bg-light-purple",
    "bg-green",
    "bg-navy",
    "bg-dark-blue",
    "bg-blue",
    "bg-light-blue",
    "bg-lightest-blue",
    "bg-light-pink",
    "bg-light-yellow",
    "bg-light-red"]

      /* var color = arr[Math.floor(Math.random()*arr.length)]
      var el = document.getElementById("container")
      el.className = color*/

</script>

</html>