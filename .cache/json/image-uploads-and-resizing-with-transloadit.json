{"data":{"markdownRemark":{"html":"<p>Giving people the ability to upload photos has been on my mind for a while because photos are a great way to help evoke memories and also to give others a better idea of what a route involves (although I guess there’s always Google Street View for that).</p>\n<p>I had pondered different methods to upload images and in the end I’m now using a third party service in the form of <a href=\"http://www.transloadit.com\">Transloadit</a>. Before starting with image uploads I was a little hesitant that it would be a task too complex for my beginner level experience so although I have previously preferred at certain times to build functionality myself, I was definitely interested in seeing how a third party service could make things easier for me.</p>\n<p>Transloadit has its own servers which you can use for image processing (in Routebop’s case resizing the image to a thumbnail before uploading both to an S3 instance. In terms of the front-end code, and on a basic level, Transloadit requires you to incorporate hidden fields in your file upload forms which allow you to send data to Transloadit’s servers detailing how you want images/media to be processed. This process blocks the normal submission of the form and once processed, links to the processed images are returned in a hidden form field and the whole form is then submitted to your server as usual.</p>\n<p>However, because Routebop just deals with submitting data via jQuery’s .ajax functionality, I used the Transloadit’s handily provided jQuery plugin to disable automatic submission of the form following Transloadit’s completion of its magic. Instead, on completion, the urls for the images as stored on S3 are firstly used to render a thumbnail on the routebop.com/new page and also stored in an object and pushed into an images array, ready to be submitted with the rest of the route when the user is ready.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#MyForm'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">transloadit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> \n  wait<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> \n  autoSubmit<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> \n  modal<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> \n  onProgress<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>bytesReceived<span class=\"token punctuation\">,</span> bytesExpected<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> \n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#progress'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Progress: \"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>bytesReceived <span class=\"token operator\">/</span> bytesExpected <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">'%'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n  onSuccess<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>assembly<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> \n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#progress'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token keyword\">var</span> thumburl <span class=\"token operator\">=</span> assembly<span class=\"token punctuation\">.</span>results<span class=\"token punctuation\">.</span>thumb<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">;</span> \n    <span class=\"token keyword\">var</span> mainurl <span class=\"token operator\">=</span> assembly<span class=\"token punctuation\">.</span>results<span class=\"token punctuation\">[</span><span class=\"token string\">':original'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">;</span> \n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#thumb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"x\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#thumb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'removeImage'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token keyword\">var</span> imgUrls <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> \n    imgUrls<span class=\"token punctuation\">[</span><span class=\"token string\">'thumburl'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> thumburl<span class=\"token punctuation\">;</span> \n    imgUrls<span class=\"token punctuation\">[</span><span class=\"token string\">'mainurl'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> mainurl<span class=\"token punctuation\">;</span> \n    images<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>imgUrls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token punctuation\">}</span> \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>In addition to adding the thumbnail from Transloadit into the page, I also wanted to add a 'x' button so users could remove the offending image. Mainly because I was lazy, instead of using an image of a red cross (to be clicked when a user wants to remove an uploaded image), I created a separate span and used a negative margin to push the <span>x</span> over the image in question. It doesn’t look quite as good as an image but I think it doesn’t look so bad (a fully circular span would be nice!). The code for that CSS is below.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\">\n      <pre class=\"gatsby-code-css\"><code class=\"gatsby-code-css\"><span class=\"token selector\">.removeImage</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> bold<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> red<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> white<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> arial<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> 16px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">margin-top</span><span class=\"token punctuation\">:</span> 0px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">margin-right</span><span class=\"token punctuation\">:</span> 12px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">margin-left</span><span class=\"token punctuation\">:</span> -8px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">margin-bottom</span><span class=\"token punctuation\">:</span> 7px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 15px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 3px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>Overall, I found incorporating Transloadit very straightforward and although I suspect I’m using it in a slightly different manner than intended, it’s working out well for me. Although it would definitely be interesting to explore building functionality to upload files directly to my S3 instance.</p>","frontmatter":{"path":"/Image-uploads-and-resizing-with-Transloadit","title":"Image uploads and resizing with Transloadit","date":null}}},"pathContext":{}}