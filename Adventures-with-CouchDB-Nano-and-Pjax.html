<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Grabeh.net</title>
  <link rel="stylesheet" href="https://unpkg.com/tachyons@4.7.0/css/tachyons.min.css" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/dracula.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>
  <style>
    body {
      font-family: 'Roboto', serif;
    }

    .grey {
      color: rgba(0, 0, 0, .4)
    }
  </style>
</head>


<body class="bg-light-red" id="container">
  <div class="pa2 f5 bg-white mb4 tc w3 shadow-5">
    <a class="b link black underline-hover" href='/'><i class="fa fa-home fa-2x" aria-hidden="true"></i></a>
  </div>
  <div class="pl5-l pr5-l mh4-ns mh2">
    <div class="fl w-70-l w-100">
      <div class="cf shadow-5 mb3 pa3 bg-white">
        <div class="f2 b">Adventures with CouchDB Nano and Pjax</div>
      </div>
      <div class="mb4-l shadow-5 bg-white ph5-ns ph3 pv1">
        <div class="f4-ns f5 w-100  lh-copy">
          <p>Note - the blog on routebop.grabeh.net used to use nanoblog however this blog uses good old fashioned html.</p>
          <p>It seemed somehow fitting to write the first blog on here about the process of creating the blog itself, so whilst
            I hope to write on a broader range of topics on the above in future, what follows below is some comment on the
            tools used to build this blog.</p>

          <p class="b">CouchDB and Nano</p>
          <p>Whilst the main site utilises MongoDB for persistence, when I was originally looking at options for persistence,
            <a href="http://couchdb.apache.org/">CouchDB</a> was of interest, so although I ending up opting for MongoDB,
            CouchDB always stuck with me. So as it was, when I decided it would be a good idea to get some thoughts down,
            I thought it would be a nice little project to put together a blog using CouchDB for persistence.</p>
          <p>When looking at how to interface with CouchDB I considered a few options. Initially, I thought it would be nice
            to make HTTP requests directly to a CouchDB instance. I looked at <a href="https://github.com/iriscouch/browser-request">browser-request</a>,
            a library from the guys at <a href="http://www.iriscouch.com">IrisCouch</a> (who coincidentally are the provider
            of the CouchDB instance used by this blog (thanks!)).</p>
          <p>Having played around with the browser variant, I ended up realising that it may be less cluttered to separate out
            concerns and leave the client-side purely for rendering the finished product.</p>
          <p>Having decided to use Node together with CouchDB, it wasn&#39;t long before I stumbled on <a href="http://github.com/dscape/nano">Nano</a>            by Nuno Job. Nano is a basic wrapper which simplifies greatly interactions with your CouchDB instance. There
            were a few points with CouchDB and Nano that were and in some cases still are stumbling for me as per the below.
          </p>
          <p class="b">Creating a database</p>
          <p>Nano exposes a .use method to specify which database you are going to use. This assumes it has previously been
            created, so the first step would be to create the database. However, the issue for me is that once created, you
            don’t want to then subsequently create a further database on each occasion. I need to therefore figure out to
            perhaps only create a database if it doesn’t already exist.</p>
          <p class="b">CouchDB views</p>
          <p>Coming from MongoDB/Mongoose, it took me a while to realise that CouchDB uses the concept of views to process and
            display data from the database. A view can be as simple as the below:</p>
          <pre><code class="f5">function(doc) {
  emit(doc._id, doc);
}
</code></pre>
          <p>This will simply map over the specified database and output an object for each row in the database, with that object
            containing the stored values. In addition to this basic functionality, you can of course do a much greater range
            of operations including reducing queries. More information on views can be found in this
            <a href="http://stackoverflow.com/a/7112722/1242579">great answer</a> on Stack Overflow. It is worth noting that
            the view must be stored directly in your CouchDB instance using the Futon manager. </p>
          <p class="b">Updating a document</p>
          <p>The concept of updating a document is from what I can tell frowned up on in CouchDB, rather than updating a document,
            you are essentially changing the pointer in your database so it point to a revised document. As a result, you
            have to supply the version of the document you wish to update. At the same time, I haven’t quite worked out if
            it is possible to only update certain values in an entry so at present, in addition to any amended values, I
            also supply the unchanged values. This to me is rather unwieldy.</p>
          <p class="b">Pjax</p>
          <p>The site also uses <a href="http://pjax.heroku.com">Pjax</a>. This tool grabs html content from the server via
            AJAX but at the same time uses html5 pushstate to alter the url accordingly. As the details at the link states
            this gives the impression of a speeded up site as the whole page isn’t being reloaded. One issue for me with
            this tool is that when I edit a page and import content from the server, it doesn’t render correctly. As a result,
            I have disabled the pjax functionality for the edit page. </p>
          <p>Another issue I haven&#39;t worked out is how to automatically enable pjax. Although I&#39;m sure it&#39;s trivial,
            in the demo it is dealt via a checkbox (as this enables you to determine performance with and without pjax enabled).</p>
          <p>To get Jquery-Pjax working with Express 3 I revised the demo <a href="https://github.com/dakatsuka/express-pjax">here</a>            to use express-partials, which allows the use of layouts with Express 3. This is because pjax works by injecting
            the html from the server into a specified section of the layout.</p>
          <p><b>Concluding thoughts</b></p>
          <p>The code for the small blog I have created is available <a href="http://www.github.com/grabbeh/nanoblog">on Github</a>.
            It is a work in progress and I hope to try to resolve some of the unresolved issues above (or some kindly person
            will stumble on this blog and enlighten me!).</p>
        </div>
      </div>
    </div>
    <div class="mb3 mt0-l mt3 pl4-l fl w-30-l w-100">
      <div class="bg-white f4 pa3 shadow-5">
        <ul class="pa0 ma0 list">
          <li class="pv1"><a class="underline link black" href="https://twitter.com/grabbeh"><i class="mr2 fa fa-twitter "aria-hidden="true"></i>Twitter</a></li>
          <li class="pv1"><a class="underline  link black " href="https://github.com/grabbeh"><i class="mr2 fa fa-github" aria-hidden="true"></i>GitHub</a></li>
          <li class="pv1"><a class="underline  link black " href="/about"><i class="mr2 fa fa-user" aria-hidden="true"></i>About</a></li>
        </ul>
      </div>
    </div>
  </div>
</body>
<script>
  var arr = [
    "bg-red",
    "bg-purple",
    "bg-light-purple",
    "bg-green",
    "bg-navy",
    "bg-dark-blue",
    "bg-blue",
    "bg-light-blue",
    "bg-lightest-blue",
    "bg-light-pink",
    "bg-light-yellow",
    "bg-light-red"]

      /* var color = arr[Math.floor(Math.random()*arr.length)]
      var el = document.getElementById("container")
      el.className = color*/

</script>

</html>

</html>